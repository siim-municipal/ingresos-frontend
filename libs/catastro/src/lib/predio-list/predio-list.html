<div
  class="p-6 bg-white rounded-lg shadow-sm border border-slate-200 min-h-[500px]"
>
  <div class="mb-6 flex justify-between items-center">
    <div>
      <h2 class="text-xl font-bold text-slate-800">Padrón Catastral</h2>
      <p class="text-sm text-slate-500">Gestión de inventario de predios</p>
    </div>
    <button mat-flat-button color="primary" class="rounded-lg">
      <mat-icon>add</mat-icon> Nuevo Predio
    </button>
  </div>

  @defer (on viewport) {

  <div
    class="relative overflow-auto max-h-[75vh] rounded-lg border border-slate-200 shadow-inner bg-white"
  >
    <table
      mat-table
      [dataSource]="loading() ? skeletonData : dataSource()"
      matSort
      [matSortActive]="sortActive()"
      [matSortDirection]="sortDirection()"
      (matSortChange)="onSortChange($event)"
      class="w-full text-sm"
    >
      <ng-container matColumnDef="claveCatastral">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="sticky-header"
        >
          Clave Catastral
        </th>
        <td mat-cell *matCellDef="let row">
          @if (loading()) { <span class="skeleton-text w-32"></span> } @else {
          <span class="font-mono font-bold text-slate-700"
            >{{ row.claveCatastral }}</span
          >
          @if(row.claveAnterior) {
          <div class="text-[10px] text-slate-400">
            Ant: {{ row.claveAnterior }}
          </div>
          } }
        </td>
      </ng-container>

      <ng-container matColumnDef="coloniaBarrio">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="sticky-header"
        >
          Colonia / Ubicación
        </th>
        <td mat-cell *matCellDef="let row">
          @if (loading()) { <span class="skeleton-text w-40"></span> } @else {
          <div class="flex flex-col">
            <span class="font-medium text-slate-800"
              >{{ row.coloniaBarrio }}</span
            >
            <span class="text-xs text-slate-500"
              >{{ row.calle || 'S/N' }} {{ row.numeroExterior }}</span
            >
          </div>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="tipoPredio">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="sticky-header"
        >
          Tipo
        </th>
        <td mat-cell *matCellDef="let row">
          @if (loading()) { <span class="skeleton-text w-16"></span> } @else {
          <span
            class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-600"
          >
            {{ row.tipoPredio }}
          </span>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="ultimoPago">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header="ultimoAnioPagado"
          class="sticky-header"
        >
          Último Pago
        </th>
        <td mat-cell *matCellDef="let row">
          @if (loading()) { <span class="skeleton-text w-12"></span> } @else {
          {{ row.ultimoAnioPagado || '---' }} }
        </td>
      </ng-container>

      <ng-container matColumnDef="estatus">
        <th mat-header-cell *matHeaderCellDef class="sticky-header">Estatus</th>
        <td mat-cell *matCellDef="let row">
          @if (loading()) { <span class="skeleton-text w-20"></span> } @else {
          @if (esDeudor(row.ultimoAnioPagado)) {
          <span class="status-badge status-debt">Con Adeudo</span>
          } @else {
          <span class="status-badge status-ok">Al Corriente</span>
          } }
        </td>
      </ng-container>

      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="text-right"></th>
        <td mat-cell *matCellDef="let row" class="text-right">
          @if (!loading()) {
          <a
            mat-icon-button
            [routerLink]="['/catastro/predio', row.id]"
            class="text-slate-400 hover:text-blue-600"
          >
            <mat-icon>visibility</mat-icon>
          </a>
          }
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns;"
        class="hover:bg-slate-50 transition-colors border-b border-slate-100"
      ></tr>

      <tr *matNoDataRow>
        <td colspan="6" class="p-12 text-center text-slate-500">
          @if (!loading()) {
          <mat-icon class="text-4xl text-slate-300 mb-2">landscape</mat-icon>
          <p>No se encontraron predios registrados.</p>
          }
        </td>
      </tr>
    </table>

    <mat-paginator
      [length]="totalElements()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="[10, 20, 50]"
      (page)="onPageChange($event)"
      class="border-t border-slate-200"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>

  } @placeholder {
  <div
    class="h-64 flex items-center justify-center bg-slate-50 rounded border border-slate-200"
  >
    <div class="flex flex-col items-center">
      <span
        class="animate-spin h-6 w-6 border-2 border-blue-500 rounded-full border-t-transparent mb-2"
      ></span>
      <span class="text-slate-400 text-sm">Cargando módulo de predios...</span>
    </div>
  </div>
  }
</div>
